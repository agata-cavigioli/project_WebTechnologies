<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta name='viewport' content='width=device-width,initial-scale=1'>



<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>


<div>
  <h5 class='text-secondary font-weight-semibold'>
    Noleggi
  </h5>
  <canvas id="dataNoloChart"></canvas>
</div>
<script>

var nolos =  [{ "id":1,"product_id" : 224,
        "client_id" : 0,
         "date_from" : "2021/01/01",
         "date_to" : "2021/03/01",
         "status" : "Iniziato",
         "nolo_data" : {
             "discount" : 10,
             "daily_cost" : 21,
             "other_fees" : 0,
             "info" : "" }
     },
     { "id":4,
     "product_id" : 224,
             "client_id" : 0,
              "date_from" : "2021/01/01",
              "date_to" : "2021/05/01",
              "status" : "Iniziato",
              "nolo_data" : {
                  "discount" : 10,
                  "daily_cost" : 2000,
                  "other_fees" : 0,
                  "info" : "" }
          },
          {"id":3,
           "product_id" : 223,
                  "client_id" : 0,
                   "date_from" : "2021/12/01",
                   "date_to" : "2021/04/01",
                   "status" : "Prenotato",
                   "nolo_data" : {
                       "discount" : 10,
                       "daily_cost" : 213,
                       "other_fees" : 0,
                       "info" : "" }
               }]
var filosofi = [{"name": "Aaron David Gordon", "birth": "1856", "birth_p": "Ukraine", "death": "1922", "death_p": "Palestine", "subjects": "Agriculture, Zionism", "nolo_data": {"cost": 134, "available_from": "", "available_to": "", "discount": 0, "condition": "Entusiasta", "info": ""}, "id": 223},
{"name": "Abraham Joshua Heschel", "birth": "1907", "birth_p": "Poland", "death": "1972", "death_p": "York", "subjects": "Judaism, Philosophy Of Religion", "nolo_data": {"cost": 245, "available_from": "", "available_to": "", "discount": 50, "condition": "Stanco", "info": ""}, "id": 224},
{"name": "Albert of Saxony", "birth": "1316", "birth_p": "Germany", "death": "1390", "death_p": "Germany", "subjects": "Gravity", "nolo_data": {"cost": 295, "available_from": "", "available_to": "", "discount": 0, "condition": "Entusiasta", "info": ""}, "id": 225},
{"name": "Alessandro Achillini", "birth": "1463", "birth_p": "Italy", "death": "1512", "death_p": "Bologna", "subjects": "William Of Ockham", "nolo_data": {"cost": 116, "available_from": "", "available_to": "", "discount": 0, "condition": "Riflessivo", "info": ""}, "id": 226},
{"name": "Alexander Gottlieb Baumgarten", "birth": "1714", "birth_p": "Germany", "death": "1762", "death_p": "Germany", "subjects": "Aesthetics, Gottfried Wilhelm Leibniz, Feeling, Christian, Baron Von Wolff", "nolo_data": {"cost": 165, "available_from": "", "available_to": "", "discount": 0, "condition": "Entusiasta", "info": ""}, "id": 227},
{"name": "Alexius Meinong", "birth": "1853", "birth_p": "Ukraine", "death": "1920", "death_p": "Austria", "subjects": "Objectivism, Intentionality", "nolo_data": {"cost": 130, "available_from": "", "available_to": "", "discount": 10, "condition": "Riflessivo", "info": ""}, "id": 228},
{"name": "Alfred Firmin Loisy", "birth": "1857", "birth_p": "France", "death": "1940", "death_p": "France", "subjects": "Philosophy Of Religion, Modernism", "nolo_data": {"cost": 226, "available_from": "", "available_to": "", "discount": 10, "condition": "Riflessivo", "info": ""}, "id": 229},
 {"name": "Alfred Korzybski", "birth": "1879", "birth_p": "Poland", "death": "1950", "death_p": "Connecticut", "subjects": "Semantics, General Semantics", "nolo_data": {"cost": 294, "available_from": "", "available_to": "", "discount": 10, "condition": "Riflessivo", "info": ""}, "id": 230},
{"name": "Alfred North Whitehead", "birth": "1861", "birth_p": "England", "death": "1947", "death_p": "Massachusetts", "subjects": "Education, Mathematics, Philosophy Of Science, Formal Logic, Materialism", "nolo_data": {"cost": 215, "available_from": "", "available_to": "", "discount": 0, "condition": "Stanco", "info": ""}, "id": 231},
{"name": "Allan Bloom", "birth": "1930", "birth_p": "Indiana", "death": "1992", "death_p": "Illinois", "subjects": "Higher Education", "nolo_data": {"cost": 220, "available_from": "", "available_to": "", "discount": 0, "condition": "Riflessivo", "info": ""}, "id": 232},
{"name": "Anaxagoras", "birth": "500", "birth_p": "Clazomenae", "death": "428", "death_p": "Lampsacus", "subjects": "Eclipse, Cosmology, Nous", "nolo_data": {"cost": 266, "available_from": "", "available_to": "", "discount": 0, "condition": "Entusiasta", "info": ""}, "id": 233}]
//**************************NOLEGGI
////////////////// DATA DEI NOLEGGI FINITO
var dataNolo = [0,0,0,0,0,0,0,0,0,0,0,0];
var month = ['Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre','Ottobre', 'Novembre','Dicembre'];
var label = 'Numero di noleggi';
for (nol in nolos){
    var d1 = new Date(nolos[nol].date_from);
    var d2 = new Date(nolos[nol].date_to);
    dataNolo[d1.getMonth()]++;
    dataNolo[d2.getMonth()]++;
}
//createChart(document.getElementById('dataNoloChart'), 'bar', month, 'Numero dei noleggi',dataNolo,'x');

//////////////////// CLASSIFICA FATTURATO FINITO
function calculateCost(nolo){
  const date1 = new Date(nolos[nol].date_from);
  const date2 = new Date(nolos[nol].date_to);
  const diffTime = Math.abs(date2 - date1);
  const diffdate = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
  var cost =(diffdate*nolo.nolo_data.daily_cost)-((diffdate*nolo.nolo_data.daily_cost*nolo.nolo_data.discount)/100)+nolo.nolo_data.other_fees;
  return cost;
}
const arrayColumn = (arr, n) => arr.map(x => x[n]);
var nolosClassified = [];
for (nol in nolos){
    //nolosClassifyName.push(nolos[nol].id);
    nolosClassified.push([calculateCost(nolos[nol]),nolos[nol].id]);
}
nolosClassified = nolosClassified.sort(function(a, b){return b[0]-a[0]});
nolosClassified = nolosClassified.slice(0, 9);
var nolosClassifyName = arrayColumn(nolosClassified, 1);
nolosClassified = arrayColumn(nolosClassified, 0);

for (i in nolosClassifyName){
    nolosClassifyName[i] = "Id del noleggio: " +  nolosClassifyName[i];
}

//createChart(document.getElementById('dataNoloChart'), 'bar', nolosClassifyName, 'Classifica del fatturato',nolosClassified,'y');
///////////////////// STATO DEI NOLEGGI FINITO
var stateNolo = [0,0,0,0]
var states = ['Prenotato', 'Iniziato', 'Concluso', 'In ritardo'];
for (nol in nolos){
    var st = nolos[nol].status;
    //console.log(st);
    if (st == 'Prenotato') stateNolo[0]++;
    else if (st == 'Iniziato') stateNolo[1]++;
    else if (st == 'Concluso') stateNolo[2]++;
    else if (st == 'In ritardo') stateNolo[4]++;
}
//createChart(document.getElementById('dataNoloChart'), 'pie', states, 'Stato dei noleggi',stateNolo,'x);

//********************************FILOSOFI
////////////////////////NUMERO NOLEGGI CLASSIFICA FINITA
var dictNumNolos = []; // create an empty array
for (i in filosofi){
	dictNumNolos.push({
	id : filosofi[i].id,
 	valore:   [filosofi[i].name,0]
    	
});
}

for (j in nolos){
	for (id in dictNumNolos){
		//console.log("id:" + dictNumNolos[id].id);
		//console.log("nome:" +dictNumNolos[id].valore[0]);
		//console.log("numero noleggi:" +dictNumNolos[id].valore[1]);
		//console.log(nolos[j].product_id);
		if(nolos[j].product_id == dictNumNolos[id].id)
			dictNumNolos[id].valore[1]++;
}
}
console.log(dictNumNolos);

var filNumClassified = [];
for (id in dictNumNolos){
    filNumClassified.push([dictNumNolos[id].valore[1],dictNumNolos[id].valore[0]]);
}
filNumClassified = filNumClassified.sort(function(a, b){return b[0]-a[0]});
filNumClassified = filNumClassified.slice(0, 9);
var filNumName = arrayColumn(filNumClassified, 1);
filNumClassified = arrayColumn(filNumClassified, 0);

createChart(document.getElementById('dataNoloChart'), 'bar', filNumName, 'Classifica del numero di noleggi',filNumClassified,'y');

////////////////////////CLASSIFICA FATTURATO

/////////////////////////CONDIZIONE filosofi FINITO
var conditionPhil = [0,0,0]
var conditions = ['Entusiasta','Stanco','Riflessivo']
for (fil in filosofi){
    var s = filosofi[fil].nolo_data.condition;
    //console.log(s);
    if (s == 'Entusiasta') conditionPhil[0]++;
    else if (s == 'Stanco') conditionPhil[1]++;
    else if (s == 'Riflessivo') conditionPhil[2]++;
}
//createChart(document.getElementById('dataNoloChart'), 'pie', conditions, 'Condizione dei filosofi',conditionPhil,'x' );

//**************************INVENTARIO
/////////////////////////////EPOCHE

////////////////////////////PROVENIENZA

//////////////////////////////TEMATICHE

//**************************CLIENTI
///////////////////////////////CLASSIFICA PER TOTALE SPESA

////////////////////////////////NUMERO NOLEGGI

///////////////////////////////////SPESA MEDIA

/////////////////////////////////
function createChart(id_div, type, labels_x, labeltotal, data, axis){
  var myChart = new Chart(id_div, {
      type: type,
      data: {
          labels: labels_x,
          datasets: [{
              label: labeltotal,
              data: data,
              backgroundColor: [
                  'rgba(255, 99, 132, 1)',
                  'rgba(54, 162, 235, 1)',
                  'rgba(255, 206, 86, 1)',
                  'rgba(75, 192, 192, 1)',
                  'rgba(153, 102, 255, 1)',
                  'rgba(255, 159, 64, 1)',
                  'rgba(255, 99, 132, 1)',
                  'rgba(54, 162, 235, 1)',
                  'rgba(255, 206, 86, 1)',
                  'rgba(75, 192, 192, 1)',
                  'rgba(153, 102, 255, 1)',
                  'rgba(255, 159, 64, 1)'
              ],
              borderColor: [
                  'rgba(255, 99, 132, 1)',
                  'rgba(54, 162, 235, 1)',
                  'rgba(255, 206, 86, 1)',
                  'rgba(75, 192, 192, 1)',
                  'rgba(153, 102, 255, 1)',
                  'rgba(255, 159, 64, 1)',
                  'rgba(255, 99, 132, 1)',
                  'rgba(54, 162, 235, 1)',
                  'rgba(255, 206, 86, 1)',
                  'rgba(75, 192, 192, 1)',
                  'rgba(153, 102, 255, 1)',
                  'rgba(255, 159, 64, 1)'
              ],
              borderWidth: 1
          }]
      },
      options: {
          indexAxis: axis,
          scales: {
              y: {
                  beginAtZero: true
              }
          }
      },
  });
}

</script>
